<!doctype html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head('Detalhes da Moto - Find Mottu')}">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-mottu fixed-top">
        <div class="container-fluid">
            <div class="navbar-brand d-flex align-items-center">
                <div class="me-2">
                    <img th:src="@{/images/logo.png}" alt="Find Mottu" width="48" height="48">
                </div>
                <span class="fw-bold text-white">Find Mottu</span>
            </div>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/dashboard}"><i class="bi bi-speedometer2 me-1"></i>Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" th:href="@{/motos}"><i class="bi bi-bicycle me-1"></i>Motos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/filiais}"><i class="bi bi-building me-1"></i>Filiais</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/usuarios}"><i class="bi bi-people me-1"></i>Usuários</a>
                    </li>
                </ul>

                <div class="navbar-nav">
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
                            <div class="user-avatar me-2">
                                <i class="bi bi-person-circle"></i>
                            </div>
                            <span th:text="${user_logged.primeiroNome + ' ' + user_logged.sobrenome}">Usuário</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-mottu">
                            <li><a class="dropdown-item" th:href="@{/logout}"><i class="bi bi-box-arrow-right me-2"></i>Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid">
            <!-- Page Header -->
            <div class="page-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="page-title">
                            <i class="bi bi-bicycle me-2"></i>Detalhes da Moto
                        </h1>
                        <p class="page-subtitle">Informações completas da moto selecionada</p>
                    </div>
                    <div class="d-flex gap-2">
                        <!-- Botão Editar -->
                        <a th:href="@{/moto/editar/{id}(id=${moto.id})}" class="btn-page-edit">
                            <i class="bi bi-pencil me-2"></i>Editar Moto
                        </a>
                        <a th:href="@{/motos}" class="btn-outline-mottu">
                            <i class="bi bi-arrow-left me-2"></i>Voltar para Lista
                        </a>
                    </div>
                </div>
            </div>

            <!-- Details Cards -->
            <div class="row g-4">
                <!-- Informações da Moto -->
                <div class="col-lg-8">
                    <div class="dashboard-card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-bicycle me-2"></i>Informações da Moto
                            </h5>
                        </div>
                        <div class="card-body">
                            <!-- Header da Moto -->
                            <div class="profile-header text-center mb-4">
                                <div class="filial-avatar mb-3">
                                    <i class="bi bi-bicycle"></i>
                                </div>
                                <h4 class="profile-name" th:text="${moto.placaMoto}">ABC-1234</h4>
                                <p class="user-id-badge">ID: #<span th:text="${moto.id}">123</span></p>
                                <span class="badge cargo-badge-large"
                                      th:classappend="${moto.statusMoto.name() == 'ATIVA'} ? 'cargo-admin' : (${moto.statusMoto.name() == 'INATIVA'} ? 'cargo-user' : 'cargo-gerente')"
                                      th:text="${moto.statusMoto.descricao}">
                                    Ativa
                                </span>
                            </div>

                            <!-- Informações Principais -->
                            <div class="detail-group mb-4">
                                <h6 class="section-subtitle">
                                    <i class="bi bi-info-circle me-2"></i>Informações Principais
                                </h6>

                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-card-text me-2"></i>Placa
                                    </div>
                                    <div class="detail-value" th:text="${moto.placaMoto}">ABC-1234</div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-gear me-2"></i>Modelo
                                    </div>
                                    <div class="detail-value" th:text="${moto.modeloMoto}">Honda CG 160</div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-qr-code me-2"></i>QR Code
                                    </div>
                                    <div class="detail-value" th:text="${moto.idQrCode}">QR123456</div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-toggle-on me-2"></i>Status
                                    </div>
                                    <div class="detail-value">
                                        <span class="badge cargo-badge-large"
                                              th:classappend="${moto.statusMoto.name() == 'ATIVA'} ? 'cargo-admin' : (${moto.statusMoto.name() == 'INATIVA'} ? 'cargo-user' : 'cargo-gerente')"
                                              th:text="${moto.statusMoto.descricao}">
                                            Ativa
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- Informações Técnicas -->
                            <div class="detail-group">
                                <h6 class="section-subtitle">
                                    <i class="bi bi-cpu me-2"></i>Informações Técnicas
                                </h6>

                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-phone me-2"></i>IMEI
                                    </div>
                                    <div class="detail-value" th:text="${moto.idImei}">123456789012345</div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-wrench me-2"></i>Número do Motor
                                    </div>
                                    <div class="detail-value" th:text="${moto.numMotor}">987654321</div>
                                </div>

                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-hash me-2"></i>Número do Chassi
                                    </div>
                                    <div class="detail-value" th:text="${moto.numChassi}">9BD12345678901234</div>
                                </div>
                            </div>

                            <!-- Ações Administrativas -->
                            <div class="admin-actions">
                                <hr class="my-4">
                                <h6 class="section-subtitle">
                                    <i class="bi bi-tools me-2"></i>Ações Administrativas
                                </h6>
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-page-delete btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                        <i class="bi bi-trash me-2"></i>Excluir Moto
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informações da Filial -->
                <div class="col-lg-4">
                    <div class="dashboard-card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="bi bi-building me-2"></i>Filial Associada
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="profile-header text-center mb-4">
                                <div class="filial-avatar mb-3">
                                    <i class="bi bi-building-fill"></i>
                                </div>
                                <h6 class="profile-name" th:text="${moto.filial.endereco}">Endereço da Filial</h6>
                                <p class="user-id-badge">ID: #<span th:text="${moto.filial.id}">1</span></p>
                            </div>

                            <div class="detail-group mb-4">
                                <div class="detail-item">
                                    <div class="detail-label">
                                        <i class="bi bi-geo-alt me-2"></i>Endereço Completo
                                    </div>
                                    <div class="detail-value" th:text="${moto.filial.endereco}">Endereço da Filial</div>
                                </div>
                            </div>

                            <div class="d-grid">
                                <a th:href="@{/filial/detalhes/{id}(id=${moto.filial.id})}" class="btn btn-outline-mottu">
                                    <i class="bi bi-eye me-2"></i>Ver Detalhes da Filial
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Histórico de Rastreamento -->
            <div class="row g-4 mt-2">
                <div class="col-12">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-geo-alt me-2"></i>Histórico de Rastreamento
                                </h5>
                                <span class="badge badge-info" th:if="${!#lists.isEmpty(moto.localizacoes)}">
                                    <i class="bi bi-pin-map me-1"></i>
                                    <span th:text="${#lists.size(moto.localizacoes)}">0</span> registros
                                </span>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Estado Vazio -->
                            <div th:if="${#lists.isEmpty(moto.localizacoes)}" class="empty-state">
                                <div class="empty-icon">
                                    <i class="bi bi-geo-alt"></i>
                                </div>
                                <h6 class="empty-title">Nenhum registro de localização</h6>
                                <p class="empty-description">Esta moto ainda não possui histórico de rastreamento registrado no sistema.</p>
                            </div>

                            <!-- Lista de Rastreamento -->
                            <div th:if="${!#lists.isEmpty(moto.localizacoes)}" class="tracking-timeline">
                                <!-- Header Info -->
                                <div class="timeline-header mb-4">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="timeline-stats">
                                                <div class="stat-item">
                                                    <i class="bi bi-clock-history text-mottu"></i>
                                                    <div class="stat-info">
                                                        <span class="stat-label">Último registro</span>
                                                        <span class="stat-value" th:text="${#temporals.format(moto.localizacoes[0].dataLocalizacao, 'dd/MM/yyyy HH:mm')}">29/09/2024 14:30</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Timeline -->
                                <div class="timeline-container">
                                    <div th:each="localizacao, iterStat : ${moto.localizacoes}" class="timeline-item">
                                        <!-- Timeline Point -->
                                        <div class="timeline-point">
                                            <div class="timeline-marker"
                                                 th:classappend="${localizacao.statusLocalizacao == 1} ? 'active' : 'inactive'">
                                                <i class="bi bi-geo-alt-fill"></i>
                                            </div>
                                            <div th:unless="${iterStat.last}" class="timeline-line"></div>
                                        </div>

                                        <!-- Content Card -->
                                        <div class="timeline-content">
                                            <div class="tracking-card">
                                                <div class="tracking-header">
                                                    <div class="tracking-time">
                                                        <i class="bi bi-calendar3 me-1"></i>
                                                        <span th:text="${#temporals.format(localizacao.dataLocalizacao, 'dd/MM/yyyy')}">29/09/2024</span>
                                                        <span class="time-separator">•</span>
                                                        <i class="bi bi-clock me-1"></i>
                                                        <span th:text="${#temporals.format(localizacao.dataLocalizacao, 'HH:mm:ss')}">14:30:15</span>
                                                    </div>
                                                    <div class="tracking-status">
                                                        <span class="status-badge"
                                                              th:classappend="${localizacao.statusLocalizacao == 1} ? 'status-active' : 'status-inactive'">
                                                            <i th:class="${localizacao.statusLocalizacao == 1} ? 'bi bi-check-circle-fill' : 'bi bi-x-circle-fill'"></i>
                                                            <span th:text="${localizacao.statusLocalizacao == 1} ? 'Ativo' : 'Inativo'">Ativo</span>
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="tracking-details">
                                                    <div class="coordinates-section">
                                                        <div class="coordinate-group">
                                                            <label class="coordinate-label">Posição X</label>
                                                            <div class="coordinate-value">
                                                                <i class="bi bi-arrows-move text-danger me-1"></i>
                                                                <span th:text="${localizacao.posX}">120</span> px
                                                            </div>
                                                        </div>
                                                        <div class="coordinate-group">
                                                            <label class="coordinate-label">Posição Y</label>
                                                            <div class="coordinate-value">
                                                                <i class="bi bi-arrows-move text-primary me-1"></i>
                                                                <span th:text="${localizacao.posY}">350</span> px
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="additional-info" th:if="${localizacao.idImagem}">
                                                        <div class="info-item">
                                                            <i class="bi bi-camera me-2 text-mottu"></i>
                                                            <span class="info-label">Imagem associada:</span>
                                                            <span class="info-value" th:text="${localizacao.idImagem}">IMG_001234</span>
                                                        </div>
                                                    </div>

                                                    <div class="tracking-actions mt-3" th:if="${localizacao.idImagem}">
                                                        <button class="btn btn-sm btn-outline-secondary">
                                                            <i class="bi bi-image me-1"></i>Ver Imagem
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Load More -->
                                <div class="timeline-footer text-center mt-4" th:if="${#lists.size(moto.localizacoes) >= 5}">
                                    <button class="btn btn-mottu">
                                        <i class="bi bi-arrow-down-circle me-2"></i>
                                        Carregar Mais Registros
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content modal-mottu">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle me-2"></i>Confirmar Exclusão
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja excluir a moto <strong th:text="${moto.placaMoto}">ABC-1234</strong>?</p>
                    <p class="text-warning">
                        <i class="bi bi-info-circle me-1"></i>
                        Esta ação não pode ser desfeita e removerá todos os dados associados à moto.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-mottu" data-bs-dismiss="modal">Cancelar</button>
                    <a th:href="@{/moto/deletar/{id}(id=${moto.id})}" class="btn-page-delete">Excluir</a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
